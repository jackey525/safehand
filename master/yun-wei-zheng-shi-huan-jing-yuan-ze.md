# 運維正式環境原則

### 一、服務器環境設定

### 網路

```
1、服務器分配在3個子網路集群，分配NAT網路或者公網
2、對外只開放ng 內網只能透過ng 對外服務
3、不隨便曝露 ng的公網ip，可以請求做 AWS LB或者 Accelerator，保護原始ip
```

### 安全組、防火牆

```
1、安全組按照不同服務功能，分開不同功能安全組設定隔離。
2、服務器對外連線的域名皆需透過 防火牆 過濾。
3、
```

### 二、服務器数据盘目录规定 下面表格列出数据盘（/data）所有目录用途

**备注：如有特殊情况，中间件安装目录可以携带版本号。**

```

/data 數據盤必須使用LVM邏輯卷，必須先將數據盤進行分區，在製作邏輯卷。

序号	  目录            	  用途
1	  /data	              数据盘根目录
2	  /data/deploy	      自己研发的应用部署目录
3	  /data/mysql	        MySQL安装目录
4	  /data/jdk	          JDK目录
5	  /data/软件名	        各种中间件安装目录，例如：/data/mysql代表MySQL安装目录
6	  /data/html	        静态资源部署根目录
7	  /data/script	      脚本存放目录
8	  /data/databack	    备份文件存放目录
9	  /data/dl	          软件下载存放目录
10	/data/tmp	          临时文件存放目录
```

### 三、软件安装规范

```
1、操作系统版本必须一致，初始化脚本必须一致。
2、所有项目软件版本必须统一，如有不统一可咨询运维组长
3、所有软件安装必须遵循数据库规定。
4、除了一些必须使用root之外的软件安装只能使用普通用户，严禁使用root用户。
5、中间件只能安装规定的软件，严禁更换其他衍生产品。
```

```
序号. 	用途	          软件	          版本号
1	   JAVA虚拟机	    JDK	          1.8
2	   WEB服务器	      nginx	        1.14.1
3	   WEB服务器	      openresty.  	1.13.6.2
4	   搜索引擎	      elasticsearch	6.2.4
5	   消息队列	      kafka	        2.2.1
6	   消息队列	      暂定	          暂定
7	   关系型数据库	    MySQL.      	5.7
8	   缓存	          redis	        4.2
9. 	 数据收集引擎	    logstash	    6.2.4
10	 NOSQL	        mongodb	      3.4
11	 操作系统	      centos	      7.5
12	 脚本语言	      Python	      3.6
13	 监控软件	      zabbix	      4.2
14	 监控软件	      ELK	          6.2.4
```

四、操作规范

```
1、禁止使用 rm -rf 命令，如有文件和目录需要删除，先移动到 /data/tmp 临时目录下面，确定没问题后再进行删除。
2、禁止私自重启服务器，重启之前需先和上级沟通后再确定。
3、服务出现异常宕机或假死，重启执行先备份现有的错误日志或者堆栈日志。
4、所有服务原则上需要全部安装监控，并做报警，报警信息需要及时处理。
5、禁止使用root及拥有root权限的账号安装部署。
```

**备注：除了MySQL和Nginx，其他应用和中间件禁止使用root及拥有sudo权限的用户启动。**

### 五、前端服务器及域名分配规范

1、前端服务器分配

```
序号	用途	服务器数量	备注
1	主页面	2	CDN做负载均衡和高可用
2	接口域名	2	CDN做负载均衡和高可用
3	劫持页面	1	专门放劫持的页面
4	媒体页面	1	专门放媒体页面
5	静态资源域名	1	专门做静态资源使用
```

2、域名配置规则

```
a. 台子在跑量的情况下，接口域名需要准备3-4个备用接口域名，必须购买企业版。
b. 劫持域名和媒体域名禁止配置到主域名服务器和接口域名服务器。
c. 服务器WEB页面服务器页面统一放到 /data/html 目录下面，如有多套劫持页面和媒体，
放置位置为如：/data/html/hijack_1、/data/html/hiack_2，方便自动化部署。
```

**备注：域名禁止混用，任何域名只能做一种用途。**
